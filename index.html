<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Empire Financer</title>

<style>
/* ======= RESET ======= */
* {
  margin:0; padding:0; box-sizing:border-box;
  font-family:'Poppins',sans-serif;
}
body {
  background:linear-gradient(120deg, #1f1c2c, #928dab);
  color:#fff;
  overflow-x:hidden;
}
button {
  cursor:pointer;
  border:none;
  outline:none;
  transition:0.3s;
}

/* ======= HEADER ======= */
header {
  width:100%;
  padding:20px;
  background:rgba(0,0,0,0.6);
  display:flex;
  justify-content:space-between;
  align-items:center;
  position:fixed;
  top:0; left:0;
  z-index:100;
}
header h1 {
  font-size:1.8rem;
  color:#ffd700;
}
header .menu-btn {
  font-size:1.8rem;
  background:none;
  color:#fff;
}

/* ======= LOGIN ======= */
#login-container {
  position:absolute;
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  background:rgba(0,0,0,0.7);
  padding:40px;
  border-radius:15px;
  width:320px;
  text-align:center;
}
#login-container h2 { color:#ffd700; margin-bottom:20px; }
#login-container input {
  width:90%;
  padding:10px;
  margin:10px 0;
  border-radius:8px;
  border:none;
}
#login-container button {
  width:95%;
  padding:12px;
  background:#4caf50;
  color:#fff;
  font-weight:bold;
  border-radius:8px;
}

/* ======= SIDEBAR PRINCIPAL ======= */
#sidebar {
  position:fixed;
  top:0; left:-250px;
  width:250px; height:100%;
  background:rgba(0,0,0,0.85);
  transition:0.4s;
  padding-top:80px;
  z-index:99;
}
#sidebar.active { left:0; }
#sidebar button {
  width:90%;
  margin:10px auto;
  padding:12px;
  background:linear-gradient(90deg,#6a11cb,#2575fc);
  border-radius:10px;
  font-weight:bold;
  color:#fff;
  display:block;
}

/* ======= MAIN ======= */
#main {
  margin-top:100px;
  padding:20px;
  transition:0.4s;
  min-height:90vh;
}

/* ======= CARDS ======= */
.card {
  background:rgba(255,255,255,0.1);
  border-radius:15px;
  padding:20px;
  margin:15px 0;
  transition:0.3s;
}
.card:hover {
  background:rgba(255,255,255,0.2);
}
.card h3 {
  color:#ffd700;
  margin-bottom:10px;
}

/* ======= TABLE ======= */
table {
  width:100%;
  border-collapse:collapse;
  margin-top:20px;
}
table th, table td {
  padding:12px;
  border-bottom:1px solid rgba(255,255,255,0.2);
  text-align:center;
}
table th {
  background:rgba(255,255,255,0.1);
}
table tr:hover {
  background:rgba(255,255,255,0.2);
}

/* CHAT */
#chat-container {
  background: rgba(255,255,255,0.1);
  border-radius: 15px;
  padding: 15px;
  margin-top: 20px;
  max-height: 350px;
  display: flex;
  flex-direction: column;
}
#chat-messages {
  flex: 1;
  overflow-y: auto;
  background: rgba(0,0,0,0.4);
  padding: 10px;
  border-radius: 10px;
}
.message { margin-bottom: 10px; }
.message span { font-weight:bold; color:#ffd700; }

#chat-input {
  width: 100%;
  margin-top: 10px;
  display: flex;
}
#chat-input input {
  flex: 1;
  padding: 10px;
  border-radius: 8px 0 0 8px;
  border: none;
}
#chat-input button {
  padding: 10px;
  background: #2575fc;
  color: #fff;
  border-radius: 0 8px 8px 0;
  font-weight: bold;
}
</style>
</head>

<body>

<header>
  <h1>Empire Financer</h1>
  <button class="menu-btn" onclick="toggleSidebar()">‚ò∞</button>
</header>

<!-- LOGIN -->
<div id="login-container">
  <h2>Connexion</h2>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Mot de passe">
  <button onclick="login()">Se connecter / Cr√©er compte</button>
  <p style="font-size:0.8rem;margin-top:10px;">Vos donn√©es sont sauvegard√©es automatiquement</p>
</div>

<!-- SIDEBAR PRINCIPAL -->
<div id="sidebar">
  <button onclick="showPage('accueil')">üè† Accueil</button>
  <button onclick="showPage('proprietes')">üè¢ Propri√©t√©s</button>
  <button onclick="showPage('entreprises')">üè≠ Entreprises</button>
  <button onclick="showPage('banque')">üè¶ Banque</button>
  <button onclick="showPage('marche')">üìà March√©</button>
  <button onclick="showPage('portefeuille')">üí∞ Portefeuille</button>
</div>

<!-- MAIN -->
<div id="main"></div>
<style>

/* ======= BOUTONS PREMIUM ======= */

.action-btn {
  padding: 10px 14px;
  border-radius: 10px;
  margin: 4px;
  font-weight: bold;
  color: #fff;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  cursor: pointer;
  transition: 0.25s;
}

/* Acheter */
.btn-buy {
  background: linear-gradient(90deg, #00c851, #007e33);
}
.btn-buy:hover {
  filter: brightness(1.15);
}

/* Vendre */
.btn-sell {
  background: linear-gradient(90deg, #ff4444, #cc0000);
}
.btn-sell:hover {
  filter: brightness(1.15);
}

/* Embellir */
.btn-upgrade {
  background: linear-gradient(90deg, #aa66cc, #9933cc);
}
.btn-upgrade:hover {
  filter: brightness(1.15);
}

/* Louer */
.btn-rent {
  background: linear-gradient(90deg, #33b5e5, #0099cc);
}
.btn-rent:hover {
  filter: brightness(1.15);
}

/* Lev√©e de fonds */
.btn-fund {
  background: linear-gradient(90deg, #fbc02d, #ffa000);
  color:#000;
}
.btn-fund:hover {
  filter: brightness(1.15);
}

/* Boutons internes entreprise */
.company-menu-btn {
  width: 90%;
  padding: 12px;
  margin: 10px auto;
  border-radius: 12px;
  background: linear-gradient(90deg, #8e2de2, #4a00e0);
  color: #fff;
  font-weight:bold;
  text-align:center;
  display:block;
}
.company-menu-btn:hover {
  opacity:0.8;
}

/* ======= POPUP CONFIRMATION ======= */

#confirm-overlay {
  position: fixed;
  top:0; left:0;
  width:100%; height:100%;
  background: rgba(0,0,0,0.7);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:500;
}

#confirm-box {
  background: rgba(20,20,20,0.95);
  padding: 25px;
  width: 350px;
  border-radius: 15px;
  text-align:center;
  border:2px solid #ffd700;
}

#confirm-box h3 {
  margin-bottom: 20px;
  color:#ffd700;
}

#confirm-box button {
  margin: 10px;
  padding: 10px 15px;
  border-radius:10px;
  font-weight:bold;
}

#confirm-yes {
  background:#4caf50;
  color:#fff;
}
#confirm-no {
  background:#d32f2f;
  color:#fff;
}
</style>

<!-- POPUP CONFIRMATION -->
<div id="confirm-overlay">
  <div id="confirm-box">
    <h3 id="confirm-message">Confirmer ?</h3>
    <button id="confirm-yes">Confirmer ‚úî</button>
    <button id="confirm-no">Annuler ‚úñ</button>
  </div>
</div>
<script>
/* =======================================================
   =============== VARIABLES GLOBALES =====================
   ======================================================= */

let currentUser = null;

let users = JSON.parse(localStorage.getItem("ef_users")) || {};

let chatMessages = JSON.parse(localStorage.getItem("ef_chat")) || [];

// Date de derni√®re mise √† jour automatique
let lastUpdate = localStorage.getItem("ef_last_update") 
  ? new Date(localStorage.getItem("ef_last_update"))
  : null;

// Propri√©t√©s priv√©es (joueur)
let biensBase = [];

// Propri√©t√©s entreprises
let batimentsPro = [];

// Entreprises du joueur
let entreprises = [];

// Liquidit√©s / patrimoine du joueur (r√©assign√©s au login)
let liquidite = 0;
let patrimoine = 0;

/* =======================================================
   =============== FONCTIONS DE SAUVEGARDE ===============
   ======================================================= */

function saveGame() {
    if (!currentUser) return;

    users[currentUser].liquidite = liquidite;
    users[currentUser].patrimoine = patrimoine;
    users[currentUser].entreprises = entreprises;
    users[currentUser].biens = users[currentUser].biens || [];

    localStorage.setItem("ef_users", JSON.stringify(users));
}

function saveChat() {
    localStorage.setItem("ef_chat", JSON.stringify(chatMessages));
}

function saveLastUpdate() {
    const now = new Date();
    localStorage.setItem("ef_last_update", now.toISOString());
}

/* =======================================================
   ================= CONFIRMATION POPUP ===================
   ======================================================= */

let confirmCallback = null;

function openConfirm(message, callback) {
    document.getElementById("confirm-message").innerText = message;
    document.getElementById("confirm-overlay").style.display = "flex";
    confirmCallback = callback;
}

document.getElementById("confirm-yes").onclick = () => {
    if (confirmCallback) confirmCallback();
    document.getElementById("confirm-overlay").style.display = "none";
};
document.getElementById("confirm-no").onclick = () => {
    document.getElementById("confirm-overlay").style.display = "none";
};

/* =======================================================
   ================== LOGIN / CREATION ====================
   ======================================================= */

function login() {
  const email = document.getElementById("email").value.trim();
  const pass = document.getElementById("password").value.trim();

  if (email === "" || pass === "") {
    alert("Veuillez remplir email et mot de passe");
    return;
  }

  // Cr√©ation de compte
  if (!users[email]) {
      users[email] = {
          password: pass,
          liquidite: 200000,
          patrimoine: 200000,
          biens: [],
          entreprises: []
      };
      saveGame();
  }

  // Mauvais mot de passe
  if (users[email].password !== pass) {
    alert("Mot de passe incorrect");
    return;
  }

  // Connexion ok
  currentUser = email;
  liquidite = users[email].liquidite;
  patrimoine = users[email].patrimoine;
  entreprises = users[email].entreprises;

  document.getElementById("login-container").style.display = "none";

  // V√©rifie si mise √† jour journali√®re n√©cessaire
  checkDailyUpdate();

  showPage("accueil");
}

/* =======================================================
   ================== MISE √Ä JOUR JOURNALI√àRE ============
   ======================================================= */

function checkDailyUpdate() {
    const now = new Date();

    // Si aucune mise √† jour jamais faite ‚Üí initialise
<script>
/* ==================== LISTE DES PROPRI√âT√âS PRIV√âES ==================== */
biensBase = [
  {nom:"T1 Standard", prix:50000, revenue:500, type:"appartement"},
  {nom:"T1 Luxueux", prix:80000, revenue:800, type:"appartement"},
  {nom:"T2 Standard", prix:90000, revenue:900, type:"appartement"},
  {nom:"T2 Luxueux", prix:150000, revenue:1500, type:"appartement"},
  {nom:"T3 Standard", prix:180000, revenue:1800, type:"appartement"},
  {nom:"T3 Luxueux", prix:250000, revenue:2500, type:"appartement"},
  {nom:"T4 Standard", prix:300000, revenue:3000, type:"appartement"},
  {nom:"T4 Luxueux", prix:400000, revenue:4000, type:"appartement"},
  {nom:"Maison de ville", prix:120000, revenue:1200, type:"maison"},
  {nom:"Maison moderne", prix:200000, revenue:2000, type:"maison"},
  {nom:"Villa Solaria", prix:250000, revenue:2000, type:"villa"},
  {nom:"Villa Lunara", prix:400000, revenue:3000, type:"villa"},
  {nom:"G√Æte Montval", prix:80000, revenue:700, type:"gite"},
  {nom:"G√Æte Rivara", prix:150000, revenue:1200, type:"gite"},
  {nom:"Petit Immeuble Zanthor", prix:600000, revenue:4500, type:"immeuble"},
  {nom:"Immeuble Luxe", prix:800000, revenue:6000, type:"immeuble"},
  {nom:"Ch√¢teau Valmor", prix:1200000, revenue:10000, type:"chateau"},
  {nom:"Palais Selyra", prix:2500000, revenue:20000, type:"palais"},
  {nom:"Manoir Eldoria", prix:1800000, revenue:12000, type:"manoir"},
  {nom:"Demeure Grandiosa", prix:3000000, revenue:25000, type:"manoir"},
  {nom:"Appartement Penthouse", prix:500000, revenue:5000, type:"appartement"},
  {nom:"Maison Contemporaine", prix:350000, revenue:3500, type:"maison"},
  {nom:"Villa C√©leste", prix:450000, revenue:4000, type:"villa"},
  {nom:"R√©sidence Riviera", prix:700000, revenue:7000, type:"immeuble"},
  {nom:"Loft Industriel", prix:400000, revenue:3500, type:"appartement"},
  {nom:"Maison de campagne", prix:250000, revenue:2200, type:"maison"},
  {nom:"G√Æte Alpina", prix:120000, revenue:1000, type:"gite"},
  {nom:"Maison Bord de Mer", prix:600000, revenue:5500, type:"maison"},
  {nom:"Villa Royale", prix:800000, revenue:7000, type:"villa"},
  {nom:"Immeuble Prestige", prix:1000000, revenue:9000, type:"immeuble"}
];

/* ==================== AFFICHAGE DES PROPRI√âT√âS ==================== */

function renderProprietes() {
  const main = document.getElementById('main');
  let html = `<div class="card">
    <h3>Propri√©t√©s</h3>
    <button class="action-btn btn-buy" onclick="showAchatProprietes()">Acheter une propri√©t√©</button>
    <button class="action-btn btn-rent" onclick="showMesProprietes()">Mes propri√©t√©s</button>
    </div>`;
  main.innerHTML = html;
}

/* ==================== MES PROPRI√âT√âS ==================== */

function showMesProprietes(){
  const main = document.getElementById('main');
  let mesBiens = users[currentUser].biens || [];

  if(mesBiens.length===0){
    main.innerHTML = `<div class="card"><h3>Mes propri√©t√©s</h3>
      <p>Vous ne poss√©dez aucun bien.</p>
      <button class="action-btn btn-rent" onclick="renderProprietes()">Retour</button></div>`;
    return;
  }

  let html = `<div class="card"><h3>Mes propri√©t√©s</h3>
  <table>
    <tr><th>Nom</th><th>Prix</th><th>Revenu</th><th>Actions</th></tr>`;

  mesBiens.forEach((bien,index)=>{
    html += `<tr>
      <td>${bien.nom} ${bien.locationActive ? "<span style='color:#4caf50'>(EN LOCATION)</span>" : ""}</td>
      <td>${bien.prix.toLocaleString()} ‚Ç¨</td>
      <td>${bien.revenue.toLocaleString()} ‚Ç¨/jour</td>
      <td>
        <button class="action-btn btn-sell" onclick="openConfirm('Vendre ${bien.nom} ?',()=>vendreBien(${index}))">Vendre</button>
        <button class="action-btn btn-upgrade" onclick="openConfirm('Embellir ${bien.nom} ?',()=>embellirBien(${index}))">Embellir</button>
        <button class="action-btn btn-rent" onclick="openConfirm('Mettre en location ${bien.nom} ?',()=>mettreEnLocation(${index}))">Location</button>
      </td>
    </tr>`;
  });

  html += `</table><button class="action-btn btn-rent" onclick="renderProprietes()">Retour</button></div>`;
  main.innerHTML = html;
}

/* ==================== ACHAT PROPRI√âT√âS ==================== */

function showAchatProprietes(){
  const main = document.getElementById('main');
  biensBase.sort((a,b)=>a.prix-b.prix);

  let html = `<div class="card"><h3>Acheter une propri√©t√©</h3>
    <table>
      <tr><th>Nom</th><th>Prix</th><th>Revenu</th><th>Action</th></tr>`;

  biensBase.forEach((bien,index)=>{
    html += `<tr>
      <td>${bien.nom}</td>
      <td>${bien.prix.toLocaleString()} ‚Ç¨</td>
      <td>${bien.revenue.toLocaleString()} ‚Ç¨/jour</td>
      <td><button class="action-btn btn-buy" onclick="openConfirm('Acheter ${bien.nom} ?',()=>acheterBien(${index}))">Acheter</button></td>
    </tr>`;
  });

  html += `</table><button class="action-btn btn-rent" onclick="renderProprietes()">Retour</button></div>`;
  main.innerHTML = html;
}

/* ==================== ACTIONS ==================== */

function acheterBien(index){
  const bien = biensBase[index];
  if(liquidite < bien.prix){alert("Pas assez d'argent"); return;}
  liquidite -= bien.prix;
  patrimoine += bien.prix;
  users[currentUser].biens.push({...bien, locationActive:false});
  saveGame();
  showAchatProprietes();
}

function vendreBien(index){
  const bien = users[currentUser].biens[index];
  liquidite += bien.prix;
  patrimoine -= bien.prix;
  users[currentUser].biens.splice(index,1);
  saveGame();
  showMesProprietes();
}

function embellirBien(index){
  let bien = users[currentUser].biens[index];
  let cout = Math.floor(bien.prix*0.5);
  if(liquidite < cout){alert("Pas assez d'argent"); return;}
  liquidite -= cout;
  bien.revenue = Math.floor(bien.revenue*1.3);
  bien.prix = Math.floor(bien.prix*1.2);
  saveGame();
  showMesProprietes();
}

function mettreEnLocation(index){
  let bien = users[currentUser].biens[index];
  bien.locationActive = true;
  saveGame();
  showMesProprietes();
}
</script>
<script>
/* ==================== LISTE DES BATIMENTS PROFESSIONNELS ==================== */
batimentsPro = [
  {nom:"Atelier de base", prix:100000, revenue:2000, type:"atelier"},
  {nom:"Atelier moderne", prix:250000, revenue:5000, type:"atelier"},
  {nom:"Usine l√©g√®re", prix:500000, revenue:10000, type:"usine"},
  {nom:"Usine avanc√©e", prix:1000000, revenue:20000, type:"usine"},
  {nom:"Centre logistique", prix:1500000, revenue:30000, type:"logistique"},
  {nom:"Centrale solaire", prix:2000000, revenue:40000, type:"centrale"},
  {nom:"Centrale nucl√©aire", prix:5000000, revenue:100000, type:"centrale"},
  {nom:"Hangar industriel", prix:300000, revenue:7000, type:"hangar"},
  {nom:"Atelier R&D", prix:800000, revenue:15000, type:"atelier"},
  {nom:"Usine robotis√©e", prix:2500000, revenue:50000, type:"usine"}
];

/* ==================== AFFICHAGE MENU ENTREPRISE ==================== */

function renderEntreprisesMenu(){
  const main = document.getElementById("main");
  main.innerHTML = `
    <div class="card" style="display:flex">
      <div style="width:200px; margin-right:20px;">
        <button class="action-btn btn-menu" onclick="showEntreprisePage('accueil')">üè† Accueil</button>
        <button class="action-btn btn-menu" onclick="showEntreprisePage('bourse')">üìà Bourse</button>
        <button class="action-btn btn-menu" onclick="showEntreprisePage('proprietes')">üè¢ Propri√©t√©s</button>
        <button class="action-btn btn-menu" onclick="showEntreprisePage('finance')">üí∞ Finance</button>
      </div>
      <div id="entreprise-main" style="flex:1;"></div>
    </div>
  `;
  showEntreprisePage("accueil");
}

/* ==================== NAVIGATION ENTREPRISE ==================== */

function showEntreprisePage(page){
  const div = document.getElementById("entreprise-main");
  div.innerHTML = "";

  if(!entreprises) entreprises = [];

  if(page === "accueil"){
    let revenuTotal = 0;
    entreprises.forEach(e=>{
      e.batiments.forEach(b=>{
        revenuTotal += b.revenue;
      });
    });

    div.innerHTML = `<h3>Accueil entreprise</h3>
      <p>Nombre d'entreprises : ${entreprises.length}</p>
      <p>Nombre total de b√¢timents : ${entreprises.reduce((acc,e)=>acc+e.batiments.length,0)}</p>
      <p>Revenu quotidien attendu : ${revenuTotal.toLocaleString()} ‚Ç¨</p>`;
  }

  else if(page === "bourse"){
    div.innerHTML = `<h3>Bourse</h3><p>Simuler fluctuations et vente d'actions...</p>`;
    // Ici on peut rajouter un syst√®me de bourse plus tard
  }

  else if(page === "proprietes"){
    let html = `<h3>Propri√©t√©s d'entreprise</h3>`;
    if(entreprises.length===0){
      html += `<p>Aucune entreprise poss√©d√©e.</p>`;
    } else {
      entreprises.forEach((e,index)=>{
        html += `<div style="border:1px solid rgba(255,255,255,0.2);padding:10px;margin-bottom:10px;">
          <h4>${e.nom}</h4>
          <p>Capital : ${e.capital.toLocaleString()} ‚Ç¨</p>
          <p>B√¢timents :</p>
          <ul>`;
        e.batiments.forEach(b=>{
          html += `<li>${b.nom} - Prix : ${b.prix.toLocaleString()} ‚Ç¨ - Revenu : ${b.revenue.toLocaleString()} ‚Ç¨/jour</li>`;
        });
        html += `</ul>
        <button class="action-btn btn-buy" onclick="openConfirm('Ajouter un b√¢timent √† ${e.nom} ?',()=>acheterBatimentEntreprise(${index}))">Acheter b√¢timent</button>
        </div>`;
      });
    }
    div.innerHTML = html;
  }

  else if(page === "finance"){
    let html = `<h3>Finance</h3>`;
    if(entreprises.length===0){
      html += `<p>Aucune entreprise poss√©d√©e.</p>`;
    } else {
      entreprises.forEach((e,index)=>{
        html += `<div style="border:1px solid rgba(255,255,255,0.2);padding:10px;margin-bottom:10px;">
          <h4>${e.nom}</h4>
          <p>Capital : ${e.capital.toLocaleString()} ‚Ç¨</p>
          <button class="action-btn btn-upgrade" onclick="openConfirm('Lev√©e de fonds pour ${e.nom} ?',()=>leveeDeFond(${index}))">Lev√©e de fonds</button>
        </div>`;
      });
    }
    div.innerHTML = html;
  }
}

/* ==================== ACHAT B√ÇTIMENT ENTREPRISE ==================== */

function acheterBatimentEntreprise(indexEntreprise){
  const e = entreprises[indexEntreprise];

  // Choisir un batiment al√©atoire disponible
  const dispo = batimentsPro[Math.floor(Math.random()*batimentsPro.length)];

  if(e.capital < dispo.prix){
    alert("Pas assez de capital pour acheter ce b√¢timent");
    return;
  }

  e.capital -= dispo.prix;
  e.batiments.push({...dispo});
  saveGame();
  showEntreprisePage("proprietes");
}

/* ==================== LEV√âE DE FONDS ==================== */

function leveeDeFond(indexEntreprise){
  const e = entreprises[indexEntreprise];
  // Ajout al√©atoire de capital entre 50k et 500k
  const montant = Math.floor(Math.random()*450000)+50000;
  e.capital += montant;
  liquidite -= montant; // On pr√©l√®ve du joueur
  saveGame();
  showEntreprisePage("finance");
}

/* ==================== CYCLE AUTOMATIQUE ENTREPRISE ==================== */

function applyDailyIncomeCycleEntreprise() {
  if(!entreprises) return;

  entreprises.forEach(e=>{
    e.batiments.forEach(b=>{
      let impots = b.prix*0.07;
      let entretien = b.prix*0.03;
      let net = b.revenue - impots - entretien;
      e.revenuAttente = e.revenuAttente || 0;
      e.revenuAttente += net;
    });
  });

  // Application du revenu apr√®s 1 jour (similaire aux propri√©t√©s)
  entreprises.forEach(e=>{
    liquidite += e.revenuAttente || 0;
    e.revenuAttente = 0;
  });

  saveGame();
}
</script>
<script>
/* ==================== POPUP DE CONFIRMATION ==================== */
function openConfirm(message, callback){
  if(confirm(message)){
    callback();
  }
}

/* ==================== CYCLE AUTOMATIQUE JOURNALIER ==================== */
function applyDailyIncomeCycle(){
  if(!currentUser) return;

  // ==== Propri√©t√©s priv√©es ====
  let revenusPropriete = 0;
  users[currentUser].biens.forEach(b=>{
    if(b.locationActive){
      let impots = b.revenue * 0.07;
      let entretien = b.revenue * 0.03;
      let net = b.revenue - impots - entretien;
      revenusPropriete += net;
    }
  });

  // ==== Entreprises ====
  let revenusEntreprise = 0;
  if(entreprises){
    entreprises.forEach(e=>{
      e.batiments.forEach(b=>{
        let impots = b.revenue * 0.07;
        let entretien = b.revenue * 0.03;
        let net = b.revenue - impots - entretien;
        revenusEntreprise += net;
      });
    });
  }

  let total = revenusPropriete + revenusEntreprise;

  // Application diff√©r√©e : argent rentre 1 jour apr√®s
  setTimeout(()=>{
    liquidite += total;
    saveGame();
    console.log(`Revenus du jour appliqu√©s : ${total.toLocaleString()} ‚Ç¨`);
  }, 24*60*60*1000); // 24h en ms, simuler 1 jour r√©el

  saveGame();
}

/* ==================== INITIALISATION AUTOMATIQUE ==================== */
function startDailyCycle(){
  // Appliquer cycle tous les jours √† 00h01
  setInterval(()=>{applyDailyIncomeCycle();}, 24*60*60*1000);
}

/* ==================== STYLE DES BOUTONS ==================== */
const styleBtn = document.createElement('style');
styleBtn.innerHTML = `
.action-btn{margin:5px;padding:8px 12px;border:none;border-radius:8px;font-weight:bold;cursor:pointer;transition:0.3s;}
.action-btn:hover{opacity:0.85;}
.btn-buy{background:linear-gradient(90deg,#6a11cb,#2575fc);color:#fff;}
.btn-sell{background:linear-gradient(90deg,#ff416c,#ff4b2b);color:#fff;}
.btn-upgrade{background:linear-gradient(90deg,#f7971e,#ffd200);color:#fff;}
.btn-rent{background:linear-gradient(90deg,#00c6ff,#0072ff);color:#fff;}
.btn-menu{background:linear-gradient(90deg,#4facfe,#00f2fe);color:#fff;width:100%;margin-bottom:10px;}
`;
document.head.appendChild(styleBtn);

/* ==================== FONCTION SAUVEGARDE GLOBALE ==================== */
function saveGame(){
  if(!currentUser) return;
  users[currentUser].patrimoine = patrimoine;
  users[currentUser].liquidite = liquidite;
  users[currentUser].entreprises = entreprises;
  localStorage.setItem('ef_users', JSON.stringify(users));
}

/* ==================== LANCEMENT AUTOMATIQUE ==================== */
window.addEventListener('load', ()=>{
  if(currentUser){
    startDailyCycle();
  }
});
</script>

